{% extends "aquaPura/base.html" %}
{% load mathfilters %}

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="/static/css/sales_over.css" />
    <title>Document</title>
  </head>
  <body>
    {% block content %}
    <h2 class="mt-4">Ventas Realizadas</h2>

    <div class="table-container">
      <table class="table">
        <thead>
          <tr>
            <th scope="col">Cliente</th>
            <th scope="col">Total</th>
            <th scope="col">Fecha</th>
            <th scope="col">Productos</th>
          </tr>
        </thead>
        <tbody>
        {% for sale in sales %}
        <tr>
          <td>{{ sale.user.first_name }} {{ sale.user.last_name }}</td>
          <td>${{ sales_totals.sale.id }}</td>
          <td>{{ sale.date }}</td>
          <td>
            <ul>
            {% for sold_product in sale.soldproduct_set.all %}
              <li>
                {{ sold_product.product.name }} 
                (Cantidad: {{ sold_product.quantity }}, 
                Precio: {{ sold_product.product.price }}, 
                Total: {{ sold_product.quantity|multiply:sold_product.product.price }})
              </li>
            {% endfor %}
            </ul>
          </td>
        </tr>
        <tr>
          <td colspan="3" style="text-align: right;">Total de la venta:</td>
          <td>${{ sales_totals.sale.id }}</td>
        </tr>
        {% endfor %}
        </tbody>
      </table>
    </div>
  </body>
  {% endblock %}
</html>
